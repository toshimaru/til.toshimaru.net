---
title: 2024-06-14 rspec custom matcher
categories: rspec
---

RSpec ã§ `RSpec::Matchers.define` ä½¿ã£ã¦ã‚«ã‚¹ã‚¿ãƒ ãƒãƒƒãƒãƒ£ã‚’ä½œæˆã—ãŸã€‚

## æ“¬ä¼¼ã‚³ãƒ¼ãƒ‰

ã“ã‚“ãªæ„Ÿã˜ã§ã€‚

```rb
RSpec::Matchers.define :send_message do |object, message|
  match do |block|
    allow(object).to receive(message)
      .tap { |m| m.with(*@with) if @with }

    block.call

    expect(object).to have_received(message)
      .tap { |m| m.with(*@with) if @with }
  end

  chain :with do |*with|
    @with = with
  end

  description do
    "#{object}.#{message}"
  end

  failure_message do
    "expected to #{description}"
  end

  supports_block_expectations
end
```

## classã§å®šç¾©

classã‚’ä½¿ã£ã¦ãƒãƒƒãƒãƒ£ãƒ¼ã‚’å®šç¾©ã™ã‚‹ã“ã¨ã‚‚ã§ãã‚‹ã€‚

```rb
def have_enqueued_job(job = nil)
  check_active_job_adapter
  ActiveJob::HaveEnqueuedJob.new(job)
end
```

<https://github.com/rspec/rspec-rails/blob/5cd1679c82c764e00500290bb60b8185cc3f48b1/lib/rspec/rails/matchers/active_job.rb#L371-L374>

## å‚è€ƒ

- [Rails: RSpecã‚’ã‚‚ã£ã¨DRYã«æ›¸ããƒ†ã‚¯ãƒ‹ãƒƒã‚¯ï¼ˆç¿»è¨³ï¼‰ï½œTechRacho by BPSæ ªå¼ä¼šç¤¾](https://techracho.bpsinc.jp/hachi8833/2023_07_11/48338)

## ã‚ã‚ã›ã¦èª­ã¿ãŸã„

- [2024-06-01 rspec have_enqueued_mail / have_enqueued_job / have_performed_job \| TTIL](/2024-06-01)
- [Many ways to write RSpec custom matchers - DEV Community](https://dev.to/povilasjurcys/many-ways-to-write-rspec-custom-matchers-m23)
- [Ruby: RSpecã®ã‚«ã‚¹ã‚¿ãƒ ãƒãƒƒãƒãƒ£ã‚’ä½œã‚‹æ–¹æ³•MEMOğŸ“ - Madogiwa Blog](https://madogiwa0124.hatenablog.com/entry/2023/05/14/175457)
